var spawn=require("child_process").spawn,fs=require("fs"),path=require("path"),jar,exists=fs.exists||path.exists,lists=fs.readdirSync(path.join(__dirname,"../build"));lists.some(function(e){if(path.extname(e)===".jar")return jar=path.join(__dirname,"../build/",e),!0}),exports.jar=jar;var defaultOptions={charset:"utf8",type:"js"},validOptions={charset:1,type:1,"line-break":1,nomunge:1,"preserve-semi":1,"disable-optimizations":1},getString=function(e,t,n){exists(e,function(r){if(r){var i=path.extname(e).replace(".","");fs.readFile(e,"utf8",function(e,r){n.type=i,t(e,r,n)})}else t(null,e,n)})},filterOptions=function(e){return Object.keys(e).forEach(function(t){validOptions[t]||delete e[t]}),e.type=e.type||"js",e.charset=e.charset||"utf8",e},compressString=function(e,t,n){t=filterOptions(t);var r=["-jar",exports.jar],i="",s="",o;Object.keys(t).forEach(function(e){r.push("--"+e),t[e]&&t[e]!==!0&&r.push(t[e])}),o=spawn("java",r,{stdio:["pipe","pipe","pipe"]}),o.stdin.write(e),o.stdin.end(),o.stdout.on("data",function(e){i+=e}),o.stderr.on("data",function(e){s+=e}),o.on("exit",function(){var e=null;s.indexOf("[ERROR]")>-1&&(e=s),n(e,i,s)})},compress=function(e,t,n){typeof t=="function"&&(n=t,t=defaultOptions),getString(e,function(e,t,r){compressString(t,r,n)},t)};exports.compress=compress,exports.compressString=compressString;